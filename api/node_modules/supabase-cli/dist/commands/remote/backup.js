"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.backup = exports.action = void 0;
const commander_1 = require("commander");
const database_1 = require("../../libs/database");
const supabase_1 = require("../../libs/supabase");
const action = async (fileName, options) => {
    const host = options.host || (await (0, supabase_1.getDatabaseHost)());
    if (!host) {
        console.error("Host name unknown");
        return;
    }
    const password = options.host || (await (0, supabase_1.getDatabasePassword)());
    if (!password) {
        console.error("Password unknown");
        return;
    }
    await (0, database_1.dumpDatabase)({ host, port: 5432, password, fileName });
};
exports.action = action;
exports.backup = commander_1.program
    .createCommand("backup")
    .description("Backup remote databases")
    .addOption(new commander_1.Option("-a, --host <host>", "Host address of database"))
    .addOption(new commander_1.Option("-p, --password <password>", "Password for database"))
    .addArgument(new commander_1.Argument("filename", "Dump file").argRequired())
    .action(exports.action);
